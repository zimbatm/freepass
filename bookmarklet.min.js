(function(e){function u(){if(!(o&&(!f||!f.closed))){j("Waiting for handshake");o=null;f=e.open(C)}}function j(a){typeof e.console!=="undefined"&&e.console.log(a);h.innerHTML=a}function l(a,b){for(k in b)if(b.hasOwnProperty(k))a[k]=b[k]}function p(a){a.stopPropagation();a.preventDefault()}function D(a,b,q){function m(){q.apply(this,arguments);a.removeEventListener(b,m,false)}a.addEventListener(b,m,false)}function E(a){function b(i){p(i);d.style.left=i.clientX-q+"px";d.style.top=i.clientY-m+"px"}var q=
a.clientX-d.offsetLeft,m=a.clientY-d.offsetTop;p(a);if(f){D(c,"mouseup",function(i){b(i);c.removeEventListener("mousemove",b,false)});c.addEventListener("mousemove",b,false)}else u()}function F(a){p(a);e.removeEventListener("message",v,false);if(r){c.removeEventListener("dblclick",w,true);x()}f&&f.close();c.body.removeChild(d)}function w(a){y(a.target)}function y(a){var b;if(a.nodeName.toLowerCase()==="input"&&a.type==="password"){a:{for(b=0;b<n.length;b++)if(n[b].a===t){b=true;break a}b=false}if(!b){b=
a.style.cssText;l(a.style,{backgroundColor:z});a.value=A;n.push({a:a,b:b})}}}function x(){for(var a;a=n.pop();)a.a.style.cssText=a.b}function v(a){if(a.origin===B)if(a.data==="hello"){a.source.postMessage('{"version":'+version+"}",a.origin);o=a.source;j("Waiting for password")}else{a=JSON.parse(a.data);if(a.hasOwnProperty("password")){A=a.password;d.style.backgroundColor=z;if(r)x();else{c.addEventListener("dblclick",w,true);r=true}s&&y(s);j("Got password, double-click on field to insert")}else throw new Error("why ??? (bug)",
a);}else j(a.origin+"!=="+B)}var c=e.document,C="${homeUrl}",B="${homeDomain}",z="#ddffdd",n=[],r=false,s,f,o,d,h,g,A;if(!c.getElementById("freepass")){if(c.activeElement.type&&c.activeElement.type.toLowerCase()=="password")s=c.activeElement;d=c.createElement("div");d.id="freepass";l(d.style,{padding:0,margin:0,border:"1px solid #aaaaaa",font:"normal 12px",fontFamily:"Trebuchet MS, Helvetica, Arial, sans-serif",textAlign:"right",position:"fixed",top:"10px",left:"10px",color:"#333333",background:"#99aabb",
zIndex:"1000000"});d.addEventListener("mousedown",E,false);h=c.createElement("span");l(h.style,{marginLeft:"2em",marginRight:"2em"});h.innerHTML="FreePass";g=c.createElement("input");l(g.style,{margin:0,padding:0,border:0,color:"inherit",background:"inherit",font:"inherit",borderRight:"1px solid #aaaaaa"});g.type="button";g.value="x";g.addEventListener("click",F,false);d.appendChild(g);d.appendChild(h);c.body.appendChild(d);e.addEventListener("message",v,false);u()}})(this);
