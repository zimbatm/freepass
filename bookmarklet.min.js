(function(e){function s(){if(!(o&&(!f||!f.closed))){j("Waiting for handshake");o=null;f=e.open(z,A)}}function j(a){typeof e.console!=="undefined"&&e.console.log(a);h.innerHTML=a}function l(a,b){for(k in b)if(b.hasOwnProperty(k))a[k]=b[k]}function p(a){a.stopPropagation();a.preventDefault()}function B(a,b,q){function m(){q.apply(this,arguments);a.removeEventListener(b,m,false)}a.addEventListener(b,m,false)}function C(a){function b(i){p(i);c.style.left=i.clientX-q+"px";c.style.top=i.clientY-m+"px"}
var q=a.clientX-c.offsetLeft,m=a.clientY-c.offsetTop;p(a);if(f){B(d,"mouseup",function(i){b(i);d.removeEventListener("mousemove",b,false)});d.addEventListener("mousemove",b,false)}else s()}function D(a){p(a);e.removeEventListener("message",t,false);if(r){d.removeEventListener("dblclick",u,true);v()}f&&f.close();d.body.removeChild(c)}function u(a){a=a.target;var b;if(a.nodeName.toLowerCase()==="input"&&a.type==="password"){a:{for(b=0;b<n.length;b++)if(n[b].a===a){b=true;break a}b=false}if(!b){b=a.style.cssText;
l(a.style,{backgroundColor:w});a.value=x;n.push({a:a,b:b})}}}function v(){for(var a;a=n.pop();)a.a.style.cssText=a.b}function t(a){if(a.origin===y)if(a.data==="hello"){a.source.postMessage("world",a.origin);o=a.source;j("Waiting for password")}else{a=JSON.parse(a.data);if(a.hasOwnProperty("password")){x=a.password;c.style.backgroundColor=w;if(r)v();else{d.addEventListener("dblclick",u,true);r=true}j("Got password, double-click on field to insert")}else throw new Error("why ??? (bug)",a);}else j(a.origin+
"!=="+y)}var d=e.document,z="${homeUrl}",y="${homeDomain}",A="${fwid}",w="#ddffdd",n=[],r=false,f,o,c,h,g,x;if(!document.getElementById("${fid}")){c=d.createElement("div");c.id="${fid}";l(c.style,{padding:0,margin:0,border:"1px solid #aaaaaa",font:"normal 12px",fontFamily:"Trebuchet MS, Helvetica, Arial, sans-serif",textAlign:"right",position:"fixed",top:"10px",left:"10px",color:"#333333",background:"#99aabb",zIndex:"1000000"});c.addEventListener("mousedown",C,false);h=d.createElement("span");l(h.style,
{marginLeft:"2em",marginRight:"2em"});h.innerHTML="FreePass";g=d.createElement("input");l(g.style,{margin:0,padding:0,border:0,color:"inherit",background:"inherit",font:"inherit",borderRight:"1px solid #aaaaaa"});g.type="button";g.value="x";g.addEventListener("click",D,false);c.appendChild(g);c.appendChild(h);d.body.appendChild(c);e.addEventListener("message",t,false);s()}})(this);
